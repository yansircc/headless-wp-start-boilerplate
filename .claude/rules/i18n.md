# i18n (Multi-language)

> 详细架构说明见 [wordpress/I18N.md](../../wordpress/I18N.md)

**SSOT**: WordPress Polylang → GraphQL `LanguageCodeEnum` → `intlayer.config.ts` + `src/lib/i18n/language.ts`

**Zero hardcoding**: 添加新语言无需修改任何映射表，`bun sync` 会从 Intlayer Locales 动态查找。

## 快速参考

```typescript
// 服务层使用共享模块
import { toLanguageFilter, toLanguageCode } from "@/lib/i18n/language";

const language = toLanguageFilter(locale); // "en" → LanguageCodeFilterEnum.En
```

## 添加新语言

```bash
# 1. WordPress Polylang 添加语言
# 2. 运行同步（自动更新 intlayer.config.ts）
bun sync
# 3. 如果有存档的翻译，sync 会提示恢复命令
#    bun i18n:restore <locale>
# 4. 否则，添加 UI 翻译到 src/content/*.content.ts
#    每个 t() 调用添加新语言: af: "[TODO:af] English text"
# 5. 翻译所有 [TODO:xx] 占位符
# 6. 验证
bun checkall
```

**验证**: `bun checkall` 会阻止构建，直到所有 `[TODO:xx]` 占位符被翻译。

## 移除语言

当从 WordPress Polylang 移除语言时，**必须**存档翻译（`checkall` 会阻止构建）：

```bash
# 1. WordPress Polylang 移除语言
# 2. 运行同步
bun sync
# 输出会提示:
#   ⚠ Orphaned translations found: af
#   Run: bun i18n:archive af

# 3. 存档翻译（必须执行，否则 checkall 失败）
bun i18n:archive af
```

存档后的翻译格式：
```typescript
t({
  en: "Articles",
  zh: "文章",
  // @archived af: "Artikels",
})
```

## 恢复已存档的翻译

当语言重新添加时，**必须**恢复存档的翻译（`checkall` 会阻止构建）：

```bash
# 1. WordPress Polylang 添加语言
# 2. 运行同步
bun sync
# 输出会提示:
#   ✗ Unrestored archived translations: af
#   Run: bun i18n:restore af

# 3. 恢复翻译（必须执行，否则 checkall 失败）
bun i18n:restore af
```

## 添加 UI 翻译

```typescript
// src/content/common.content.ts
navigation: {
  newItem: t({
    en: "New Item",
    zh: "新项目",
    ja: "新しい項目",
  }),
}
```
